<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeCalc SV - 3v3 Simulation</title>
    <link rel="stylesheet" href="style.css?v=2">
</head>
<body>
    <header>
        <h1>ポケモン対戦シミュレーター (3vs3)</h1>
        <div class="party-selector">
            <div class="team ally-team">
                <span>自分:</span>
                <button class="poke-slot active" data-team="ally" data-index="0">1</button>
                <button class="poke-slot" data-team="ally" data-index="1">2</button>
                <button class="poke-slot" data-team="ally" data-index="2">3</button>
            </div>
            <div class="team enemy-team">
                <span>相手:</span>
                <button class="poke-slot" data-team="enemy" data-index="0">1</button>
                <button class="poke-slot" data-team="enemy" data-index="1">2</button>
                <button class="poke-slot" data-team="enemy" data-index="2">3</button>
            </div>
        </div>
    </header>

    <main class="calc-container">
        <!-- 自分側設定 -->
        <section class="poke-settings ally">
            <h2>自分</h2>
            
            <div class="hp-status">
                <div class="hp-text">HP: <span id="ally-current-hp">150</span> / <span id="ally-max-hp">150</span></div>
                <div class="hp-bar-container">
                    <div class="battle-hp-bar" id="ally-hp-bar" style="width: 100%; background-color: var(--primary-green);"></div>
                </div>
            </div>

            <input type="text" id="ally-name-input" placeholder="ポケモン名入力" class="search-input" list="pokemon-list">
            <div id="ally-base-stats" class="base-stats-info"></div>
            
            <div class="grid-params">
                <label>レベル: <input type="number" id="ally-level-input" value="50" min="1" max="100"></label>
                <label>テラスタル: 
                    <select id="ally-tera-select">
                        <option>なし</option>
                        <option>一致テラス</option>
                        <option>不一致テラス</option>
                    </select>
                </label>
            </div>

            <div class="stats-table">
                <table>
                    <thead>
                        <tr>
                            <th>ステータス</th>
                            <th>個体値</th>
                            <th>努力値</th>
                            <th>性格</th>
                            <th>実数値</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- HP -->
                        <tr>
                            <td>HP</td>
                            <td><input type="number" class="stat-input" data-stat="hp" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="hp" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>-</td> <!-- HPに性格補正はない -->
                            <td class="final-stat" id="ally-stat-val-hp">175</td> <!-- 仮の値 -->
                        </tr>
                        <!-- 攻撃 -->
                        <tr>
                            <td>攻撃</td>
                            <td><input type="number" class="stat-input" data-stat="attack" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="attack" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="attack" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="ally-stat-val-attack">150</td>
                        </tr>
                        <!-- 防御 -->
                        <tr>
                            <td>防御</td>
                            <td><input type="number" class="stat-input" data-stat="defense" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="defense" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="defense" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="ally-stat-val-defense">135</td>
                        </tr>
                        <!-- 特攻 -->
                        <tr>
                            <td>特攻</td>
                            <td><input type="number" class="stat-input" data-stat="spAtk" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="spAtk" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="spAtk" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="ally-stat-val-spAtk">115</td>
                        </tr>
                        <!-- 特防 -->
                        <tr>
                            <td>特防</td>
                            <td><input type="number" class="stat-input" data-stat="spDef" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="spDef" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="spDef" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="ally-stat-val-spDef">115</td>
                        </tr>
                        <!-- 素早さ -->
                        <tr>
                            <td>素早さ</td>
                            <td><input type="number" class="stat-input" data-stat="speed" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="speed" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="speed" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="ally-stat-val-speed">122</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="options">
                <label>特性: <select id="ally-ability-select"><option>てきおうりょく</option></select></label>
                <label>持ち物: 
                    <select id="ally-item-select">
                        <option value="">なし</option>
                    </select>
                    <button type="button" class="item-trigger-btn" data-side="ally" title="持ち物の効果を手動で発動します">発動</button>
                    <span id="ally-item-status" class="item-status"></span>
                </label>
            </div>

            <div class="move-selector">
                <h3>技構成</h3>
                <div class="move-config-grid">
                    <select class="move-select" data-index="0" id="ally-move-0"></select>
                    <select class="move-select" data-index="1" id="ally-move-1"></select>
                    <select class="move-select" data-index="2" id="ally-move-2"></select>
                    <select class="move-select" data-index="3" id="ally-move-3"></select>
                </div>

                <h3>技選択</h3>
                <div class="move-grid ally-move-grid" id="ally-move-grid">
                    <!-- Javascriptでボタン生成 -->
                </div>
            </div>

            <div class="field-conditions ally-conditions">
                <h3>フィールド・状態</h3>
                <label><input type="checkbox" class="condition-check" data-cond="isReflector"> リフレクター</label>
                <label><input type="checkbox" class="condition-check" data-cond="isMultiTarget"> 複数対象攻撃(3/4倍) [5]</label>
                <label><input type="checkbox" class="condition-check" data-cond="isCrit"> 急所 [6]</label>
            </div>

            <div class="damage-result-info">
                <hr>
                <h3>ダメージ計算結果</h3>
                <p class="damage-range">-</p>
                <p class="kill-chance">-</p>
                <h4 class="random-table-title">16段階乱数テーブル</h4>
                <ul class="random-list"></ul>
                <hr>
                <div class="history-header">
                    <h4>被ダメージ履歴</h4>
                    <button class="clear-history-btn" data-side="ally">クリア</button>
                </div>
                <ul class="damage-history" id="ally-damage-history"></ul>
            </div>
        </section>

        <!-- 計算結果表示（中央） -->
        <section class="result-display">
            <div class="action-panel">
                <div class="action-buttons">
                <!-- 攻撃方向ボタン -->
                 <p>【攻撃ボタン】</p>
                <button id="execute-ally-attack" class="action-btn"><span style="font-weight: bold; font-size: 1.2em;">自分</span> → 相手</button>
                <br><br>
                <button id="execute-enemy-attack" class="action-btn">自分 ← <span style="font-weight: bold; font-size: 1.2em;">相手</span></button>

            </div>
            </div>

            <hr>
            <div class="battle-log-header">
                <h3>対戦ログ</h3>
                <button id="clear-battle-log-btn" class="clear-history-btn">ログ消去</button>
            </div>
            <div id="battle-log-container" class="battle-log-container">
                <ul id="battle-log-list" class="battle-log-list">
                    <!-- 全体のターン履歴が表示される -->
                    <li class="log-placeholder">攻撃ボタンを押すと対戦の記録がここに表示されます</li>
                </ul>
            </div>
        </section>

        <!-- 相手側設定 -->
        <section class="poke-settings enemy">
            <h2>相手</h2>
            
            <div class="hp-status">
                <div class="hp-text">HP: <span id="enemy-current-hp">150</span> / <span id="enemy-max-hp">150</span></div>
                <div class="hp-bar-container">
                    <div class="battle-hp-bar" id="enemy-hp-bar" style="width: 100%; background-color: var(--primary-green);"></div>
                </div>
            </div>

            <input type="text" id="enemy-name-input" placeholder="ポケモン名入力" class="search-input" list="pokemon-list">
            <div id="enemy-base-stats" class="base-stats-info"></div>
            
            <div class="stats-table">
                <table>
                    <thead>
                        <tr>
                            <th>ステータス</th>
                            <th>個体値</th>
                            <th>努力値</th>
                            <th>性格</th>
                            <th>実数値</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- HP -->
                        <tr>
                            <td>HP</td>
                            <td><input type="number" class="stat-input" data-stat="hp" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="hp" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>-</td>
                            <td class="final-stat" id="enemy-stat-val-hp">-</td>
                        </tr>
                        <!-- 攻撃 -->
                        <tr>
                            <td>攻撃</td>
                            <td><input type="number" class="stat-input" data-stat="attack" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="attack" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="attack" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="enemy-stat-val-attack">-</td>
                        </tr>
                        <!-- 防御 -->
                        <tr>
                            <td>防御</td>
                            <td><input type="number" class="stat-input" data-stat="defense" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="defense" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="defense" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="enemy-stat-val-defense">-</td>
                        </tr>
                        <!-- 特攻 -->
                        <tr>
                            <td>特攻</td>
                            <td><input type="number" class="stat-input" data-stat="spAtk" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="spAtk" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="spAtk" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="enemy-stat-val-spAtk">-</td>
                        </tr>
                        <!-- 特防 -->
                        <tr>
                            <td>特防</td>
                            <td><input type="number" class="stat-input" data-stat="spDef" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="spDef" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="spDef" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="enemy-stat-val-spDef">-</td>
                        </tr>
                        <!-- 素早さ -->
                        <tr>
                            <td>素早さ</td>
                            <td><input type="number" class="stat-input" data-stat="speed" data-type="iv" value="31" max="31" min="0"></td>
                            <td>
                                <div class="ev-input-container">
                                    <input type="number" class="stat-input" data-stat="speed" data-type="ev" value="0" max="252" min="0">
                                    <button type="button" class="ev-252-btn">252</button>
                                </div>
                            </td>
                            <td>
                                <select class="stat-input" data-stat="speed" data-type="nature">
                                    <option value="neutral">--</option>
                                    <option value="up">+</option>
                                    <option value="down">-</option>
                                </select>
                            </td>
                            <td class="final-stat" id="enemy-stat-val-speed">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="options">
                <label>特性: <select id="enemy-ability-select"><option>未設定</option></select></label>
                <label>持ち物: 
                    <select id="enemy-item-select">
                        <option value="">なし</option>
                    </select>
                    <button type="button" class="item-trigger-btn" data-side="enemy" title="持ち物の効果を手動で発動します">発動</button>
                    <span id="enemy-item-status" class="item-status"></span>
                </label>
            </div>

            <div class="move-selector">
                <h3>技構成</h3>
                <div class="move-config-grid">
                    <select class="move-select" data-index="0" id="enemy-move-0"></select>
                    <select class="move-select" data-index="1" id="enemy-move-1"></select>
                    <select class="move-select" data-index="2" id="enemy-move-2"></select>
                    <select class="move-select" data-index="3" id="enemy-move-3"></select>
                </div>

                <h3>技選択</h3>
                <div class="move-grid enemy-move-grid" id="enemy-move-grid">
                     <!-- Javascriptでボタン生成 -->
                </div>
            </div>

            <div class="field-conditions enemy-conditions">
                <h3>フィールド・状態</h3>
                <label><input type="checkbox" class="condition-check" data-cond="isReflector"> リフレクター</label>
                <label><input type="checkbox" class="condition-check" data-cond="isMultiTarget"> 複数対象攻撃(3/4倍) [5]</label>
                <label><input type="checkbox" class="condition-check" data-cond="isCrit"> 急所 [6]</label>
            </div>
            
            <div class="damage-result-info">
                <hr>
                <h3>ダメージ計算結果</h3>
                <p class="damage-range">-</p>
                <p class="kill-chance">-</p>
                <h4 class="random-table-title">16段階乱数テーブル ※自身で選択可能</h4>
                <ul class="random-list"></ul>
                <hr>
                <div class="history-header">
                    <h4>被ダメージ履歴</h4>
                    <button class="clear-history-btn" data-side="enemy">クリア</button>
                </div>
                <ul class="damage-history" id="enemy-damage-history"></ul>
            </div>
        </section>
    </main>
    <datalist id="pokemon-list"></datalist>
    <script type="module" src="js/main.js?v=20"></script>
</body>
</html>