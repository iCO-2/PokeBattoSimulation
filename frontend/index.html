<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeCalc SV - 3v3 Simulation</title>
    <link rel="icon" href="../backend/data/image/PlaySphere.png">
    <link rel="stylesheet" href="style.css?v=20">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>ポケモン対戦シミュレーター</h1>
        <div class="party-selector">
            <div class="team ally-team">
                <span>自分</span>
                <button class="poke-slot active" data-team="ally" data-index="0">1</button>
                <button class="poke-slot" data-team="ally" data-index="1">2</button>
                <button class="poke-slot" data-team="ally" data-index="2">3</button>
                <button class="poke-slot" data-team="ally" data-index="3">4</button>
                <button class="poke-slot" data-team="ally" data-index="4">5</button>
                <button class="poke-slot" data-team="ally" data-index="5">6</button>
            </div>
            
            <div class="versus-divider">
                <span class="vs-text">VS</span>
            </div>

            <div class="team enemy-team">
                <span>相手</span>
                <button class="poke-slot" data-team="enemy" data-index="0">1</button>
                <button class="poke-slot" data-team="enemy" data-index="1">2</button>
                <button class="poke-slot" data-team="enemy" data-index="2">3</button>
                <button class="poke-slot" data-team="enemy" data-index="3">4</button>
                <button class="poke-slot" data-team="enemy" data-index="4">5</button>
                <button class="poke-slot" data-team="enemy" data-index="5">6</button>
            </div>
        </div>
    </header>

    <!-- Mobile Tab Navigation -->
    <div class="mobile-tab-nav">
        <button class="tab-btn active" data-tab="ally">自分のチーム</button>
        <button class="tab-btn" data-tab="battle">対戦ログ</button>
        <button class="tab-btn" data-tab="enemy">相手のチーム</button>
    </div>

    <main class="calc-container">
        <!-- 自分側設定 -->
        <section class="poke-settings ally tab-content active" id="tab-ally">
            <h2>自分</h2>
            
            <div class="hp-status">
                <div class="hp-text">HP: <span id="ally-current-hp">150</span> / <span id="ally-max-hp">150</span></div>
                <div class="hp-bar-container">
                    <div class="battle-hp-bar" id="ally-hp-bar" style="width: 100%; background-color: var(--primary-green);"></div>
                </div>
            </div>

            <div class="autocomplete-container">
                <input type="text" id="ally-name-input" placeholder="ポケモン名を入力してください" class="search-input" autocomplete="off">
                <button type="button" class="clear-input-btn" data-target="ally-name-input" aria-label="入力をクリア">×</button>
                <ul id="ally-autocomplete-list" class="autocomplete-list"></ul>
            </div>
            <div id="ally-base-stats" class="base-stats-info"></div>
            
            <!-- 使用率データ表示セクション -->
            <div class="usage-rate-section" id="ally-usage-rate-section" style="display: none;">
                <div class="usage-rate-header collapsed" id="ally-usage-rate-header">
                    <h3>採用率データをみる <span class="toggle-icon">▼</span></h3>
                </div>
                <div class="usage-rate-content collapsed" id="ally-usage-rate-content">
                    <div class="usage-rate-charts">
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/move_record.png" alt="技">技</h4>
                            <canvas id="ally-chart-trend-moves"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/item.png" alt="持ち物">持ち物</h4>
                            <canvas id="ally-chart-trend-items"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/mint.png" alt="性格">性格</h4>
                            <canvas id="ally-chart-trend-personalities"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/terastal.png" alt="テラスタイプ">テラスタイプ</h4>
                            <canvas id="ally-chart-trend-tera-types"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid-params">
                <label>テラスタル: 
                    <select id="ally-tera-select">
                        <option>なし</option>
                        <option>一致テラス</option>
                        <option>不一致テラス</option>
                    </select>
                </label>
            </div>

            <div class="stats-container">
                <!-- HP (No Nature) -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">HP</div>
                        <div class="stat-value" id="ally-stat-val-hp">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group empty">
                            <!-- HP has no rank -->
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="hp" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="hp" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="hp" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group empty">
                            <!-- HP has no nature -->
                        </div>
                    </div>
                </div>

                <!-- Attack -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">こうげき</div>
                        <div class="stat-value" id="ally-stat-val-attack">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="attack">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="attack" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="attack" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="attack" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="attack" data-val="down">▼</button>
                                <span class="nature-display" data-stat="attack"></span>
                                <button type="button" class="nature-btn up" data-stat="attack" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Defense -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">ぼうぎょ</div>
                        <div class="stat-value" id="ally-stat-val-defense">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="defense">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="defense" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="defense" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="defense" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="defense" data-val="down">▼</button>
                                <span class="nature-display" data-stat="defense"></span>
                                <button type="button" class="nature-btn up" data-stat="defense" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SpA -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">とくこう</div>
                        <div class="stat-value" id="ally-stat-val-spAtk">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="spAtk">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="spAtk" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="spAtk" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="spAtk" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="spAtk" data-val="down">▼</button>
                                <span class="nature-display" data-stat="spAtk"></span>
                                <button type="button" class="nature-btn up" data-stat="spAtk" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SpD -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">とくぼう</div>
                        <div class="stat-value" id="ally-stat-val-spDef">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="spDef">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="spDef" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="spDef" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="spDef" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="spDef" data-val="down">▼</button>
                                <span class="nature-display" data-stat="spDef"></span>
                                <button type="button" class="nature-btn up" data-stat="spDef" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Speed -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">すばやさ</div>
                        <div class="stat-value" id="ally-stat-val-speed">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="speed">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="speed" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="speed" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="speed" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="speed" data-val="down">▼</button>
                                <span class="nature-display" data-stat="speed"></span>
                                <button type="button" class="nature-btn up" data-stat="speed" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="options">
                <label><span class="option-label">特性:</span><select id="ally-ability-select"><option>未設定</option></select></label>
                <label><span class="option-label">持ち物:</span>
                    <select id="ally-item-select">
                        <option value="">未設定</option>
                    </select>
                    <button type="button" class="item-trigger-btn" data-side="ally" title="持ち物の効果を手動で発動します">発動</button>
                    <span id="ally-item-status" class="item-status"></span>
                </label>
            </div>

            <div class="move-selector">
                <h3>技</h3>
                <div class="move-config-grid">
                    <div class="move-row">
                        <input type="radio" name="ally-active-move" value="0" class="move-select-radio" checked>
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="0" id="ally-move-0" placeholder="技1" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="ally-move-0" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                    <div class="move-row">
                        <input type="radio" name="ally-active-move" value="1" class="move-select-radio">
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="1" id="ally-move-1" placeholder="技2" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="ally-move-1" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                    <div class="move-row">
                        <input type="radio" name="ally-active-move" value="2" class="move-select-radio">
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="2" id="ally-move-2" placeholder="技3" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="ally-move-2" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                    <div class="move-row">
                        <input type="radio" name="ally-active-move" value="3" class="move-select-radio">
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="3" id="ally-move-3" placeholder="技4" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="ally-move-3" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-conditions ally-conditions">
                <h3>フィールド・状態</h3>
                <label><input type="checkbox" class="condition-check" data-cond="isReflector"> リフレクター</label>
                <label><input type="checkbox" class="condition-check" data-cond="isMultiTarget"> 複数対象攻撃(3/4倍) [5]</label>
                <label><input type="checkbox" class="condition-check" data-cond="isCrit"> 急所 [6]</label>
            </div>

            <div class="damage-history-container">
                <div class="history-header">
                    <h4>被ダメージ履歴</h4>
                    <button class="clear-history-btn" data-side="ally">クリア</button>
                </div>
                <ul class="damage-history" id="ally-damage-history"></ul>
            </div>
        </section>

        <!-- 計算結果表示（中央） -->
        <section class="result-display tab-content" id="tab-battle">
            <div class="action-panel">
                <div class="action-buttons">
                <!-- 攻撃方向ボタン -->
                 <p>【攻撃ボタン】</p>
                 <div class="action-buttons-container">
                    <button id="execute-ally-attack" class="action-btn ally-attack-btn">
                        <img src="../backend/data/image/trainer_ally.png" alt="Ally" class="trainer-icon">
                        <span class="btn-main-text">自分が攻撃</span>
                    </button>
                    
                    <button id="execute-enemy-attack" class="action-btn enemy-attack-btn">
                        <img src="../backend/data/image/trainer_enemy.png" alt="Enemy" class="trainer-icon">
                        <span class="btn-main-text">相手が攻撃</span>
                    </button>
                 </div>

            </div>
            </div>

            <!-- Centralized Damage Result -->
            <div class="damage-result-container">
                <h3>計算結果</h3>
                <div class="result-header-display" style="display: none;">
                    <div class="icon-wrapper">
                        <img id="result-ally-icon" class="pokemon-icon-small" src="" alt="">
                        <div class="mini-hp-bar"><div id="result-ally-mini-hp-fill" class="mini-hp-bar-fill"></div></div>
                    </div>
                    <div class="move-arrow-display">
                        <span id="result-move-name" class="move-name-display"></span>
                        <div class="arrow-icon" id="result-arrow-icon">➜</div>
                    </div>
                    <div class="icon-wrapper">
                        <img id="result-enemy-icon" class="pokemon-icon-small" src="" alt="">
                        <div class="mini-hp-bar"><div id="result-enemy-mini-hp-fill" class="mini-hp-bar-fill"></div></div>
                    </div>
                </div>
                <div class="result-row">
                    <span class="label">ダメージ:</span>
                    <span class="value damage-range"></span>
                </div>
                <div class="result-row">
                    <span class="label">瀕死率:</span>
                    <span class="value kill-chance"></span>
                </div>
                <div class="result-row">
                    <span class="label">持ち物補正:</span>
                    <span class="value item-modifier"></span>
                </div>
                <div class="result-row">
                    <span class="label">採用乱数:</span>
                    <select class="random-select" id="battle-random-roll">
                        <option value="-1">-- 乱数選択 --</option>
                    </select>
                </div>
            </div>

            <hr>
            <div class="battle-log-header">
                <h3>対戦ログ</h3>
                <button id="clear-battle-log-btn" class="clear-history-btn">ログ消去</button>
            </div>
            <div id="battle-log-container" class="battle-log-container">
                <ul id="battle-log-list" class="battle-log-list">
                    <!-- 全体のターン履歴が表示される -->
                    <li class="log-placeholder">攻撃ボタンを押すと対戦の記録がここに表示されます</li>
                </ul>
            </div>
        </section>

        <!-- 相手側設定 -->
        <section class="poke-settings enemy tab-content" id="tab-enemy">
            <h2>相手</h2>
            
            <div class="hp-status">
                <div class="hp-text">HP: <span id="enemy-current-hp">150</span> / <span id="enemy-max-hp">150</span></div>
                <div class="hp-bar-container">
                    <div class="battle-hp-bar" id="enemy-hp-bar" style="width: 100%; background-color: var(--primary-green);"></div>
                </div>
            </div>

            <div class="autocomplete-container">
                <input type="text" id="enemy-name-input" placeholder="ポケモン名を入力してください" class="search-input" autocomplete="off">
                <button type="button" class="clear-input-btn" data-target="enemy-name-input" aria-label="入力をクリア">×</button>
                <ul id="enemy-autocomplete-list" class="autocomplete-list"></ul>
            </div>
            <div id="enemy-base-stats" class="base-stats-info"></div>
            
            <!-- 使用率データ表示セクション -->
            <div class="usage-rate-section" id="enemy-usage-rate-section" style="display: none;">
                <div class="usage-rate-header collapsed" id="enemy-usage-rate-header">
                    <h3>採用率データをみる <span class="toggle-icon">▼</span></h3>
                </div>
                <div class="usage-rate-content collapsed" id="enemy-usage-rate-content">
                    <div class="usage-rate-charts">
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/move_record.png" alt="技">技</h4>
                            <canvas id="enemy-chart-trend-moves"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/item.png" alt="持ち物">持ち物</h4>
                            <canvas id="enemy-chart-trend-items"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/ability.png" alt="性格">性格</h4>
                            <canvas id="enemy-chart-trend-personalities"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4><img class="usage-rate-icon" src="../backend/data/image/terastal.png" alt="テラスタイプ">テラスタイプ</h4>
                            <canvas id="enemy-chart-trend-tera-types"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
                <div class="stats-container">
                <!-- HP (No Nature) -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">HP</div>
                        <div class="stat-value" id="enemy-stat-val-hp">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group empty">
                            <!-- HP has no rank -->
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="hp" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="hp" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="hp" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group empty">
                            <!-- HP has no nature -->
                        </div>
                    </div>
                </div>

                <!-- Attack -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">こうげき</div>
                        <div class="stat-value" id="enemy-stat-val-attack">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="attack">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="attack" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="attack" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="attack" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="attack" data-val="down">▼</button>
                                <span class="nature-display" data-stat="attack"></span>
                                <button type="button" class="nature-btn up" data-stat="attack" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Defense -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">ぼうぎょ</div>
                        <div class="stat-value" id="enemy-stat-val-defense">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="defense">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="defense" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="defense" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="defense" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="defense" data-val="down">▼</button>
                                <span class="nature-display" data-stat="defense"></span>
                                <button type="button" class="nature-btn up" data-stat="defense" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SpA -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">とくこう</div>
                        <div class="stat-value" id="enemy-stat-val-spAtk">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="spAtk">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="spAtk" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="spAtk" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="spAtk" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="spAtk" data-val="down">▼</button>
                                <span class="nature-display" data-stat="spAtk"></span>
                                <button type="button" class="nature-btn up" data-stat="spAtk" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SpD -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">とくぼう</div>
                        <div class="stat-value" id="enemy-stat-val-spDef">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="spDef">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="spDef" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="spDef" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="spDef" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="spDef" data-val="down">▼</button>
                                <span class="nature-display" data-stat="spDef"></span>
                                <button type="button" class="nature-btn up" data-stat="spDef" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Speed -->
                <div class="stat-row">
                    <div class="stat-result-box">
                        <div class="stat-label">すばやさ</div>
                        <div class="stat-value" id="enemy-stat-val-speed">-</div>
                    </div>
                    <div class="stat-controls flex-row">
                        <div class="rank-group">
                            <label>ランク</label>
                            <select class="rank-select" data-stat="speed">
                                <option value="6">+6</option>
                                <option value="5">+5</option>
                                <option value="4">+4</option>
                                <option value="3">+3</option>
                                <option value="2">+2</option>
                                <option value="1">+1</option>
                                <option value="0" selected>±0</option>
                                <option value="-1">-1</option>
                                <option value="-2">-2</option>
                                <option value="-3">-3</option>
                                <option value="-4">-4</option>
                                <option value="-5">-5</option>
                                <option value="-6">-6</option>
                            </select>
                        </div>
                        <div class="ev-group">
                            <label>能力P</label>
                            <div class="ev-control-row">
                                <input type="number" class="stat-input ev-input" data-stat="speed" data-type="ev" value="0" max="32" min="0">
                                <button type="button" class="tune-btn" data-stat="speed" data-action="down" title="-1 実数値">▼</button>
                                <button type="button" class="tune-btn" data-stat="speed" data-action="up" title="+1 実数値">▲</button>
                                <button type="button" class="preset-btn" data-val="0">0</button>
                                <button type="button" class="preset-btn" data-val="32">32</button>
                            </div>
                        </div>
                        <div class="nature-group">
                            <label>性格 補正</label>
                            <div class="nature-toggle">
                                <button type="button" class="nature-btn down" data-stat="speed" data-val="down">▼</button>
                                <span class="nature-display" data-stat="speed"></span>
                                <button type="button" class="nature-btn up" data-stat="speed" data-val="up">▲</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <div class="options">
                <label><span class="option-label">特性:</span><select id="enemy-ability-select"><option>未設定</option></select></label>
                <label><span class="option-label">持ち物:</span>
                    <select id="enemy-item-select">
                        <option value="">未設定</option>
                    </select>
                    <button type="button" class="item-trigger-btn" data-side="enemy" title="持ち物の効果を手動で発動します">発動</button>
                    <span id="enemy-item-status" class="item-status"></span>
                </label>
            </div>

            <div class="move-selector">
                <h3>技</h3>
                <div class="move-config-grid">
                    <div class="move-row">
                        <input type="radio" name="enemy-active-move" value="0" class="move-select-radio" checked>
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="0" id="enemy-move-0" placeholder="技1" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="enemy-move-0" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                    <div class="move-row">
                        <input type="radio" name="enemy-active-move" value="1" class="move-select-radio">
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="1" id="enemy-move-1" placeholder="技2" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="enemy-move-1" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                    <div class="move-row">
                        <input type="radio" name="enemy-active-move" value="2" class="move-select-radio">
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="2" id="enemy-move-2" placeholder="技3" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="enemy-move-2" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                    <div class="move-row">
                        <input type="radio" name="enemy-active-move" value="3" class="move-select-radio">
                        <div class="move-input-wrapper">
                            <div class="move-input-field">
                                <input class="move-select" data-index="3" id="enemy-move-3" placeholder="技4" autocomplete="off">
                                <button type="button" class="clear-input-btn" data-target="enemy-move-3" aria-label="入力をクリア">×</button>
                            </div>
                            <ul class="custom-autocomplete-list"></ul>
                            <div class="move-info-display"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-conditions enemy-conditions">
                <h3>フィールド・状態</h3>
                <label><input type="checkbox" class="condition-check" data-cond="isReflector"> リフレクター</label>
                <label><input type="checkbox" class="condition-check" data-cond="isMultiTarget"> 複数対象攻撃(3/4倍) [5]</label>
                <label><input type="checkbox" class="condition-check" data-cond="isCrit"> 急所 [6]</label>
            </div>
            
            <div class="damage-history-container">
                <div class="history-header">
                    <h4>被ダメージ履歴</h4>
                    <button class="clear-history-btn" data-side="enemy">クリア</button>
                </div>
                <ul class="damage-history" id="enemy-damage-history"></ul>
            </div>
        </section>
    </main>


    <div class="mobile-sticky-footer">
    <div class="mobile-sticky-footer">
        <div class="mobile-action-buttons">
            <button id="mobile-attack-ally" class="mobile-action-btn ally-attack">
                <img src="../backend/data/image/trainer_ally.png" alt="Ally" class="mobile-trainer-icon">
                <span class="mobile-btn-text">自分が攻撃</span>
            </button>
            <button id="mobile-attack-enemy" class="mobile-action-btn enemy-attack">
                <span class="mobile-btn-text">相手が攻撃</span>
                <img src="../backend/data/image/trainer_enemy.png" alt="Enemy" class="mobile-trainer-icon">
            </button>
        </div>
    </div>

    <script type="module" src="js/data/loader.js?v=121"></script>
    <script type="module" src="js/calc/stats.js?v=118"></script>
    <script type="module" src="js/calc/damage.js?v=202"></script>
    <script type="module" src="js/models/PokemonModel.js?v=118"></script>
    <script type="module" src="js/AppState.js?v=117"></script>
    <script type="module" src="js/main.js?v=129"></script>
</body>
</html>